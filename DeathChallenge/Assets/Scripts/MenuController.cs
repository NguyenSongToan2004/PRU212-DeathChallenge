using UnityEngine;
using UnityEngine.SceneManagement;

public class MenuController : MonoBehaviour
{
    public static GameObject selectedPlayerPreview; // Reference to the selected player preview
    // List player preview list
    [SerializeField] private GameObject[] playerPreviews;
    private int currentIndex = 0;


    //public void Start()
    //{
    //    // T·∫Øt t·∫•t c·∫£ c√°c preview tr∆∞·ªõc
    //    foreach (var preview in playerPreviews)
    //    {
    //        preview.SetActive(false);
    //    }

    //    // Hi·ªÉn th·ªã preview ƒë·∫ßu ti√™n
    //    if (playerPreviews.Length > 0)
    //    {
    //        currentIndex = 0;
    //        playerPreviews[currentIndex].SetActive(true);
    //        UpdateSelectedCharacter();
    //    }
    //}

    public void Start()
    {
        // Set the first player preview as selected by default
        if (playerPreviews.Length > 0)
        {
            selectedPlayerPreview = playerPreviews[0];
            selectedPlayerPreview.SetActive(true);
        }

        // üîç Ki·ªÉm tra v√† log
        if (selectedPlayerPreview != null)
        {
            Debug.Log("Nh√¢n v·∫≠t ƒëang ƒë∆∞·ª£c ch·ªçn: " + selectedPlayerPreview.name);
        }
        else
        {
            Debug.LogWarning("Ch∆∞a c√≥ nh√¢n v·∫≠t n√†o ƒë∆∞·ª£c ch·ªçn.");
        }
    }

    private void UpdateSelectedCharacter()
    {
        // L∆∞u ch·ªâ s·ªë c·ªßa nh√¢n v·∫≠t ƒë∆∞·ª£c ch·ªçn v√†o GameData
        if (GameData.instance != null)
        {
            GameData.instance.selectedCharacterIndex = currentIndex;
        }
    }

    //public void NextPlayer()
    //{
    //    // Find the index of the currently active player preview
    //    int currentIndex = System.Array.IndexOf(playerPreviews, selectedPlayerPreview);
    //    // Calculate the next index, wrapping around if necessary
    //    int nextIndex = (currentIndex + 1) % playerPreviews.Length;
    //    // Set the new selected player preview
    //    selectedPlayerPreview.SetActive(false);
    //    selectedPlayerPreview = playerPreviews[nextIndex];
    //    selectedPlayerPreview.SetActive(true);
    //}

    public void NextPlayer()
    {
        playerPreviews[currentIndex].SetActive(false);
        currentIndex = (currentIndex + 1) % playerPreviews.Length;
        playerPreviews[currentIndex].SetActive(true);
        UpdateSelectedCharacter();
    }

    //public void PreviousPlayer()
    //{
    //    // Find the index of the currently active player preview
    //    int currentIndex = System.Array.IndexOf(playerPreviews, selectedPlayerPreview);
    //    // Calculate the previous index, wrapping around if necessary
    //    int previousIndex = (currentIndex - 1 + playerPreviews.Length) % playerPreviews.Length;
    //    // Set the new selected player preview
    //    selectedPlayerPreview.SetActive(false);
    //    selectedPlayerPreview = playerPreviews[previousIndex];
    //    selectedPlayerPreview.SetActive(true);
    //}

    public void PreviousPlayer()
    {
        playerPreviews[currentIndex].SetActive(false);
        currentIndex = (currentIndex - 1 + playerPreviews.Length) % playerPreviews.Length;
        playerPreviews[currentIndex].SetActive(true);
        UpdateSelectedCharacter();
    }

    public void ChangeScene(string sceneName)
    {
        if (sceneName.Equals("Quit", System.StringComparison.OrdinalIgnoreCase))
        {
            ExitGame();
        }
        else
        {
            // L∆∞u scene ƒë√≠ch v√†o static variable tr∆∞·ªõc khi chuy·ªÉn sang LoadingScene
            Loading.TargetSceneName = sceneName;
            // Chuy·ªÉn sang LoadingScene
            SceneManager.LoadScene("LoadingScene");
        }
    }

    public void ExitGame()
    {
        Application.Quit();
#if UNITY_EDITOR
        UnityEditor.EditorApplication.isPlaying = false; // D·ª´ng ch∆°i trong Editor
#endif
    }
}